# ==============================================================================
#                      Adresu Plugin Configuration Example
# ==============================================================================
# This is an example configuration file. To use it, copy it to 'config.toml'
# and uncomment/edit the values according to your needs.
#
#   cp config.toml.example config.toml
# ==============================================================================

# --- Log Settings ---
#[log]
# Log level can be: "debug", "info", "warn", "error".
#level = "info"

# --- Basic Service Settings ---
#[database]
# Path to the plugin's database file. It will be created automatically.
# Ensure the directory exists and the application has write permissions.
#path = "./plugin.db"

#[strfry]
# Paths to the strfry executable and its configuration file.
# Required for the plugin to manage strfry (e.g., for banning users).
#executable_path = "/usr/local/bin/strfry"
#config_path     = "/etc/strfry.conf"


# ==============================================================================
#                         Global Relay Policy
# ==============================================================================
#[policy]
# Pubkey of the moderator in HEX format. Required for manual bans via reactions.
#moderator_pubkey = ""

# Emoji used in a reaction to an event to trigger a BAN.
#ban_emoji = "ðŸ”¨"

# Emoji used in a reaction to an event to trigger an UNBAN.
#unban_emoji = "ðŸ”“"

# Default duration of a manual ban. Examples: "24h", "7d", "30d".
#ban_duration = "720h"

# List of event kinds that your relay WILL accept.
# If 'allowed_kinds' is defined, any kind NOT in this list is denied.
#allowed_kinds = [0, 1, 3, 5, 6, 7, 30023]

# List of event kinds that your relay will NOT accept.
# If 'denied_kinds' is defined, any kind NOT in this list is allowed.
#denied_kinds = [4, 40, 41, 42, 43, 44]


# ==============================================================================
#                            Event Filters
# ==============================================================================
# All filters are disabled unless their section is uncommented.
#[filters]

# --- Freshness Filter ---
# Rejects events that are too old or have a timestamp too far in the future.
#[filters.freshness]
#max_past   = "24h" # Maximum age of an event.
#max_future = "15m" # Maximum time in the future an event's timestamp can be.

# --- Event Size Filter ---
#[filters.size]
# Default size limit in bytes for all kinds without a specific rule.
#default_max_size_bytes = 16384 # 16 KiB

# You can define specific rules for different kinds.
#[[filters.size.rule]]
#description    = "Limit long-form articles to 100 KiB"
#kinds          = [30023]
#max_size_bytes = 102400

# --- Tags Filter ---
# Sets limits on event tags. Rules are applied in order.
#[filters.tags]
#[[filters.tags.rule]]
#description    = "Rules for standard notes"
#kinds          = [1]
#max_tags       = 10 # Maximum total number of tags.
#required_tags  = [] # List of required tag names (e.g., ["e", "p"]).
#max_tag_counts = { p = 4 } # Max count for specific tags (e.g., max 4 '#p' tags).

# --- Keyword and Regular Expression Filter ---
#[filters.keywords]
#enabled = false
#[[filters.keywords.rule]]
#description = "Block specific spam words or patterns"
#kinds       = [1]
#words       = ["spamword1", "spamword2"] # Case-insensitive words.
#regexps     = ["https?://spam-domain\\.com"] # Regular expressions.

# --- Ephemeral Chats Filter ---
#[filters.ephemeral_chat]
#enabled                    = false
#kinds                      = [20000, 23333] # Kinds to apply these rules to.
#min_delay_between_messages = "1s" # Anti-flood delay between messages from the same user.
#max_caps_ratio             = 0.0  # 0.0 to disable. Max ratio of uppercase letters (e.g., 0.5 = 50%).
#min_letters_for_caps_check = 20   # Minimum number of letters to trigger caps check.
#max_character_repetitions  = 0    # 0 to disable. Max number of repeating characters (e.g., "sooooo" > 4).
#max_word_length            = 120  # Rejects messages with words longer than this.
#block_zalgo_text           = true # Blocks text with excessive combining characters.
#cache_size                 = 10000 # In-memory cache size for tracking users.
#rate_limit_rate            = 0.166 # Events per second if PoW is not used. ~10/min.
#rate_limit_burst           = 5     # Burst allowance for the rate limiter.
#required_pow_on_limit      = 12    # Required PoW difficulty if rate limit is exceeded.

# --- Language Filter ---
#[filters.language]
#enabled                = false
#allowed_languages      = ["en", "ja"] # List of allowed languages.
#kinds_to_check         = [1, 30023]
#min_length_for_check   = 20 # Skip check for very short texts.
#approved_cache_ttl     = "30m" # Cache duration for authors who pass the check.
#approved_cache_size    = 10000
# Special thresholds for similar languages. Example: allows Ukrainian if detected as Russian with low confidence.
#[filters.language.primary_accept_threshold.ru]
#uk = 0.0002
#default = 0.018 # Default minimum confidence for a language to be accepted as Russian.

# --- Global Rate Limiter ---
#[filters.rate_limiter]
#enabled       = false
#by            = "both" # Limit by "ip", "pubkey", or "both".
#cache_size    = 65536
#ttl           = "10m" # How long an entry stays in cache after last activity.
#default_rate  = 0.5  # Default events per second.
#default_burst = 5    # Default burst allowance.
#[[filters.rate_limiter.rule]]
#description = "Stricter limit for creating articles"
#kinds       = [30023]
#rate        = 0.0017 # ~1 article per 10 minutes
#burst       = 1

# --- Repost Abuse Filter ---
#[filters.repost_abuse]
#enabled                  = false
#max_ratio                = 0.7 # Max ratio of reposts (kinds 6, 16) to other events. 0.7 = 70%.
#min_events               = 20  # Minimum number of events from a user before this filter applies.
#reset_duration           = "12h" # User's activity ratio resets after this period of inactivity.
#cache_ttl                = "24h" # How long user activity data is kept in cache.
#count_reject_as_activity = false # If true, events rejected by other filters still count as user activity.
#require_nip21_in_quote   = false # For kind 16, require a "nostr:..." URI in the content.

# --- Automatic Ban Filter (Autoban) ---
#[filters.autoban]
#enabled             = false
#max_strikes         = 10   # Ban after this many rejected events...
#strike_window       = "1h" # ...if they occurred within this time window.
#ban_duration        = "24h" # Duration of the automatic ban.
#strikes_cache_size  = 10000
#cooldown_cache_size = 1000
#cooldown_duration   = "1m" # User won't get a new strike for this duration after receiving one.
# List of filters whose rejections DO NOT result in a 'strike'.
#exclude_filters_from_strikes = ["RateLimiterFilter", "FreshnessFilter"]